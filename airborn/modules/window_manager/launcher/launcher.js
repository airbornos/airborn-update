var apps,toggleApps=document.createElement("div");toggleApps.id="toggleApps";toggleApps.className="barButton";toggleApps.textContent="Apps";toggleApps.tabIndex="0";toggleApps.addEventListener("click",function(){apps.classList.toggle("shown")});toggleApps.addEventListener("keypress",function(a){13!==a.which&&32!==a.which||apps.classList.toggle("shown")});document.body.appendChild(toggleApps);apps=document.createElement("div");apps.id="apps";apps.className="barMenu";apps.textContent="Loading\u2026";
document.body.appendChild(apps);loadApps();document.body.addEventListener("click",function(a){if(a=a.target){for(;"app"!==a.className;)if(a=a.parentElement,!a||a.parentElement===a)return;openTab(a.dataset.path)}});document.body.addEventListener("keypress",function(a){if(13===a.which&&(a=a.target)){for(;"app"!==a.className;)if(a=a.parentElement,!a||a.parentElement===a)return;a.click();apps.classList.remove("shown")}});
function loadApps(){var a=document.createDocumentFragment();airborn.fs.getFile("/Apps/",{codec:"dir"},function(k){function g(){Object.keys(e).sort().forEach(function(c){c=e[c];var b=document.createElement("div");b.className="app";b.textContent=c.name.replace(/ /g,"\u00a0");var d=document.createElement("img");d.src=c.iconUrl||"";b.insertBefore(d,b.firstChild);b.tabIndex="0";b.title=c.name;b.dataset.path="/Apps/"+c.path;a.appendChild(b)});apps.innerHTML="";apps.appendChild(a)}var f=0,h=0,e={};Object.keys(k).forEach(function(a){".history/"!==
a.substr(-9)&&(f++,airborn.fs.getFile("/Apps/"+a+"manifest.webapp",function(b){b=b?JSON.parse(b.replace(/^\uFEFF/,"")):{};var d=getName(b);(b=getIconUrl(b.icons))?airborn.fs.prepareUrl(b,{relativeParent:"/Apps/"+a,rootParent:"/Apps/"+a},function(b){e[a]={name:d,path:a,iconUrl:b};++h===f&&g()}):(e[a]={name:d,path:a},++h===f&&g())}))})})}airborn.fs.listenForFileChanges("/Apps/",function(a){"/Apps/"===a&&loadApps()});
document.documentElement.addEventListener("click",function(a){a.target!==apps&&a.target!==toggleApps&&apps.classList.remove("shown")});
