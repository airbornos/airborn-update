var set={},string={};set.equal=function(a,b){return a===b||a&&b&&(a.__id__&&a.__id__===b.__id__||a.text&&a.text===b.text)};set.diff=function(a,b){for(var d=0,e=0,f=[];d<=a.length||e<=b.length;)if(set.equal(a[d],b[e]))d++,e++;else{var c;for(c=e+1;c<=b.length;c++)if(set.equal(a[d],b[c])){f.push([d,0].concat(b.slice(e,c)));d++;e=c+1;break}if(c===b.length+1){for(c=d+1;c<=a.length;c++)if(set.equal(a[c],b[e])){f.push([d,c-d]);e++;d=c+1;break}c===a.length+1&&(f.push([d,1].concat([b[e]])),d++,e++)}}return f.reverse()};
set.merge=function(a,b,d){function e(a,b){return a.length===b.length&&a[0]===b[0]&&a[1]===b[1]&&a.slice(2).every(function(a,c){return set.equal(a,b[c+2])})}function f(a,b){return a.fromSecond!==b.fromSecond&&b[0]<=a[0]+a[1]}b.forEach(function(a){a.fromSecond=!0});a=a.concat(b);a.sort(function(a,b){return b[0]-a[0]});for(b=1;b<a.length;b++)e(a[b],a[b-1])?a.splice(b,1):f(a[b],a[b-1])&&(console.log("merge conflict:",a[b-1],a[b]),a.splice.apply(a,[b-1,2].concat(d(a[b-1],a[b]))));return a};
set.patch=function(a,b){a=a.slice();for(var d=0;d<b.length;d++)a.splice.apply(a,b[d]);return a};set.merge3=function(a,b,d,e){return set.patch(a,set.merge(set.diff(a,b),set.diff(a,d),e))};
string.merge3=function(a,b,d,e){function f(a,b){if(a===b)return 0;if(0===a.length)return b.length;if(0===b.length)return a.length;var d=Array(b.length+1),c=Array(b.length+1),g,e;for(g=0;g<d.length;g++)d[g]=g;for(g=0;g<a.length;g++){c[0]=g+1;for(e=0;e<b.length;e++)c[e+1]=Math.min(c[e]+1,d[e+1]+1,d[e]+(a[g]===b[e]?0:1));for(e=0;e<d.length;e++)d[e]=c[e]}return c[b.length]}function c(a,b,d,e,c){var f=c.length,q,l={};return a.split(b).map(function(a){var b={text:a},h;a=q;q=null;c[a+1]&&!l[c[a+1].__id__]&&
(d(b.text,c[a+1].text)||e(b.text,c[a+1].text))?(h=c[a+1].__id__,l[c[a+1].__id__]=!0,q=a+1):c.some(function(a,c){if(!l[a.__id__]&&d(b.text,a.text))return h=a.__id__,l[a.__id__]=!0,q=c,!0});b.__id__=h;return b}).map(function(a){if(!a.__id__){var b;c.some(function(h,c){if(!l[h.__id__]&&e(a.text,h.text))return b=h.__id__,l[h.__id__]=!0,q=c,!0});b||(b=++f);a.__id__=b}return a})}function w(a,b){return a.filter(function(a){return a}).map(function(a){return a.text}).join(b)}function p(a){[].slice.call(arguments,
1).forEach(function(b){Object.keys(b).forEach(function(c){var d=b[c];null!=d&&d.constructor===Object?a.hasOwnProperty(c)?p(a[c],d):a[c]=p({},d):void 0===d?delete a[c]:a[c]=d})});return a}function k(a){return a.map(function(a){return p({},a)})}function u(a,b){return a===b}function v(a,b){return 100<a.length&&.2>f(a,b)/a.length}a=c(a,"\n",u,v,[]);b=c(b,"\n",u,v,k(a));d=c(d,"\n",u,v,k(a).concat(k(b)));var t={};a.forEach(function(a){t[a.__id__]=a.text});var m={};b.forEach(function(a){m[a.__id__]=a.text});
var r={};d.forEach(function(a){r[a.__id__]=a.text});var n={};a.concat(b).concat(d).forEach(function(a){function b(a,c){return a===c}function d(){return!1}if(!n.hasOwnProperty(a.__id__))if(t[a.__id__]===m[a.__id__])n[a.__id__]=r[a.__id__];else if(t[a.__id__]===r[a.__id__])n[a.__id__]=m[a.__id__];else if(m[a.__id__]===r[a.__id__])n[a.__id__]=m[a.__id__];else{var f=c(t[a.__id__]||"",/\b/,b,d,[]),g=c(m[a.__id__]||"",/\b/,b,d,k(f)),p=c(r[a.__id__]||"",/\b/,b,d,k(f).concat(k(g)));n[a.__id__]=w(set.merge3(f,
g,p,e),"")}});return set.merge3(a,b,d,e).map(function(a){return n[a.__id__]}).join("\n")};
