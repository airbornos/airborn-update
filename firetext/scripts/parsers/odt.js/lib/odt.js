var ODTDocument=function(B,C){var l=new JSZip(B,C),t=function(a,c){var f;Object.keys(a).some(function(d){if(a[d]===c)return f=d,!0});return f},u=function(a,c){return a+'="'+c.replace(/"/g,"&quot;")+'"'},a={"fo:text-align":"text-align","style:font-name":"font-family","fo:font-size":"font-size","fo:font-weight":"font-weight","fo:font-style":"font-style","fo:color":"color","fo:padding":"padding","fo:padding-top":"padding-top","fo:padding-right":"padding-right","fo:padding-bottom":"padding-bottom","fo:padding-left":"padding-left",
"fo:border":"border","fo:border-top":"border-top","fo:border-right":"border-right","fo:border-bottom":"border-bottom","fo:border-left":"border-left","style:width":"width","style:column-width":"width"},z=function(w,c){return"style:text-underline-style"===w&&"solid"===c?"text-decoration: underline; "+z(w.replace(":","--"),c):"style:text-position"===w?"vertical-align: "+c.split(" ")[0]+";font-size: "+c.split(" ")[1]+"; "+z(w.replace(":","--"),c):(a[w]||w.replace(":","--"))+": "+c+";"},D={"text:style-name":"class",
"table:style-name":"class","table:number-columns-spanned":"colspan","table:number-rows-spanned":"rowspan","table:number-columns-repeated":"span","xlink:href":"href","xml:id":"id"},r={"office:document-content":"html","office:body>>office:text":"body","office:scripts":"script","text:p":"p","text:span":"span","text:a":"a","text:list":"ol","text:list-item":"li","text:line-break":"br","table:table":"table","table:table-row":"tr","table:table-column":"col","table:table-cell":"td","draw:frame>>draw:image":"img",
"draw:object":"object","office:automatic-styles":"style","office:font-face-decls":"style/fonts"},g="area base br col command embed hr img input keygen link meta param source track wbr".split(" "),f=function(a){var c=[];a.forEach(function(a,w){c.push(w)});return c},y={},p=function(a,c){if(a.nodeType===a.TEXT_NODE)return a.nodeValue.replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/[^\u0009\u000A\u000D\u0020-\uD7FF\uE000-\uFFFD]/g,"").replace(/\u00A0/g,"&nbsp;");for(var d=function(a){var b=(r[h]||
h).replace(/\/(.*)/,' data-type="$1"'),e=b.split(" ")[0];return"<"+b+f(n).map(function(a){var b=n.get(a);return" "+u(D[a]||a,b)}).join("")+">"+(-1===g.indexOf(e)?a()+"</"+e+">":"")},m=function(a){return"/*<"+h+f(n).map(function(a){return" "+u(a,n.get(a))}).join("")+">*/\n"+a()+"\n/*</"+h+">*/"},q=function(a){return a.nodeType===a.TEXT_NODE?a.nodeValue.replace(/</g,"&lt;").replace(/>/g,"&gt;"):"<"+a.nodeName+b(a.attributes)+">"+[].map.call(a.childNodes,q).join("")+"</"+a.nodeName+">"},b=function(a){return[].map.call(a,
function(a){return" "+u(a.name,a.value)}).join("")},h=a.nodeName,n=new Map,k=0;k<a.attributes.length;k++)n.set(a.attributes[k].name,a.attributes[k].value);for(k=0;k<a.childNodes.length;k++)if(r[h+">>"+a.childNodes[k].nodeName]){h+=">>"+a.childNodes[k].nodeName;n.set("_child_attrs",b(a.childNodes[k].attributes));n.set("_children_before",[].slice.call(a.childNodes,0,k).map(q).join(""));n.set("_children_after",[].slice.call(a.childNodes,k+1).map(q).join(""));switch(h){case "draw:frame>>draw:image":m=
a.childNodes[k].attributes["xlink:href"].value,/^[a-z]+:/i.test(m)?n.set("src",m):(m=m.replace(/^\.\//,""),k=l.file(m).asBinary(),"VCLMTF"===k.substr(0,6)?(y[m]||(y[m]=parseSVM(l.file(m).asArrayBuffer()).toDataURL()),n.set("src",y[m])):n.set("src","data:image/png;base64,"+btoa(k)))}return d(function(){return c().match(/^<[^>]*>([\s\S]*)<\/[^>]*>$/)[1]})}switch(h){case "text:tab":return'<span style="white-space:pre">\t</span>';case "text:note-body":c=function(a){return function(){return a().replace(/<(\/?)p\b/g,
"<$1text:p")}}(c);break;case "office:annotation":c=function(a){return function(){return a().replace(/<(\/?)p\b/g,"<$1text:p").replace(/<(\/?)ol\b/g,"<$1text:list").replace(/<(\/?)li\b/g,"<$1text:list-item")}}(c);break;case "style:style":case "text:list-style":return m(function(){return['[class="'+n.get("style:name")+'"] {',c(),"}"].join("\n")});case "style:paragraph-properties":case "style:text-properties":case "style:table-properties":case "style:table-column-properties":case "style:table-cell-properties":case "style:graphic-properties":return m(function(){return f(n).map(function(a){return z(a,
n.get(a))+"\n"}).join("")+c()});case "draw:object":n.set("data","bla")}return"style:"===h.substr(0,6)||"svg:font-face-"===h.substr(0,14)||"text:list-level-style-"===h.substr(0,22)?m(c):d(c)},A=function(a,c){if(3===a.nodeType)return a.nodeValue.replace(/&nbsp;/g,"\u00a0");for(var d=function(a,b,e){return"<"+a+b+">"+e()+"</"+a+">"},g=function(a){return f(a).map(function(b){if("data-type"===b)return"";var e=a.get(b);b="class"===b&&"table:"===k.substr(0,6)?u("table:style-name",e):u(t(D,b)||b,e);return" "+
b}).join("")},q=a.nodeName.toLowerCase(),b=new Map,h=0;h<a.attributes.length;h++)b.set(a.attributes[h].name,a.attributes[h].value);switch(q){case "html":var l={"xmlns:office":"urn:oasis:names:tc:opendocument:xmlns:office:1.0","xmlns:style":"urn:oasis:names:tc:opendocument:xmlns:style:1.0","xmlns:text":"urn:oasis:names:tc:opendocument:xmlns:text:1.0","xmlns:table":"urn:oasis:names:tc:opendocument:xmlns:table:1.0","xmlns:draw":"urn:oasis:names:tc:opendocument:xmlns:drawing:1.0","xmlns:xlink":"http://www.w3.org/1999/xlink",
"office:version":"1.2"};Object.keys(l).forEach(function(a){b.set(a,b.get(a)||l[a])});break;case "style":if(void 0!==b.get("_odt.js_styles"))return"";c=function(a){return function(){return(a().match(/\/\*.*?\*\//g)||[]).map(function(a){return a.match(/\/\*(.*?)\*\//)[1].replace(/&lt;/g,"<").replace(/&gt;/g,">")}).join("")}}(c);break;case "span":if("white-space:pre"===b.get("style")&&"\t"===c())return"<text:tab></text:tab>";break;case "img":b.delete("src");break;case "draw:object":b.delete("data")}var k=
t(r,q+"/"+b.get("data-type"))||t(r,q)||-1!==q.indexOf(":")&&q;if(!k)return c();if(-1!==k.indexOf(">>")){var G=b.get("_child_attrs"),H=b.get("_children_before"),e=b.get("_children_after");b.delete("_child_attrs");b.delete("_children_before");b.delete("_children_after");return d(k.split(">>")[0],g(b),function(){return H+d(k.split(">>")[1],G,c)+e})}return d(k,g(b),c)},x=function(a,c){return c(a,function(){return[].map.call(a.childNodes,function(a){return 1===a.nodeType?x(a,c):c(a)}).join("")})},d=function(a){return'<?xml version="1.0" encoding="UTF-8"?>\n'+
x((new DOMParser).parseFromString(a,"text/html").documentElement,A).replace(/'/g,"&apos;")},v=function(a){return a.replace(/<([\w:-]+)([^>]*)><\/\1>/g,"<$1$2/>").replace(/<(\/?)([\w:-]+)\s*([^>]*?)(\/?)>/g,function(a,d,f,g,b){return"<"+d+f+" "+g.split(/\s+/).sort().join(" ")+b+">"}).replace(/<\/?(?:tbody|colgroup) >/g,"")},E=function(a){var c=a.doctype;return(c?"<!DOCTYPE "+c.name+(c.publicId?' PUBLIC "'+c.publicId+'"':"")+(!c.publicId&&c.systemId?" SYSTEM":"")+(c.systemId?' "'+c.systemId+'"':"")+
">":"")+a.documentElement.outerHTML};this.getHTMLUnsafe=function(){return"<!DOCTYPE html>"+x((new DOMParser).parseFromString(l.file("content.xml").asText(),"text/xml").documentElement,p).replace(/<html[^>]*>/,'$&<head><style _odt.js_styles="">\np {\n\tmargin: 0;\n\tmin-height: 1em;\n}\ntable {\n\tborder-collapse: collapse;\n}\noffice\\:annotation {\n\tdisplay: none;\n}\ntext\\:note-citation, text\\:note-body {\n\tvertical-align: super;\n\tfont-size: .83em;\n}\ntext\\:note-body:before {\n\tcontent: "\\A0(";\n}\ntext\\:note-body:after {\n\tcontent: ")";\n}\ntext\\:tracked-changes {\n\tdisplay: none;\n}\n</style>').replace("<body",
"</head>$&")};this.setHTMLUnsafe=function(a){l.file("content.xml",d(a))};this.getHTML=function(){var a=this.getHTMLUnsafe(),c=E((new DOMParser).parseFromString(a,"text/html"));if(v(c)!==v(a))throw Error("Couldn't parse ODT file: produced invalid HTML.");var d={},f={};Object.keys(l.files).forEach(function(a){d[a]=l.files[a].asBinary();"content.xml"===a&&(d[a]=v(d[a]))});this.setHTMLUnsafe(c);Object.keys(l.files).forEach(function(a){f[a]=l.files[a].asBinary();"content.xml"===a&&(f[a]=v(f[a]))});if(JSON.stringify(f)!==
JSON.stringify(d)||v(this.getHTMLUnsafe())!==v(a))throw Error("Couldn't parse ODT file: roundtrip failed.");return a};this.setHTML=function(a){this.setHTMLUnsafe(a);if(v(this.getHTML())!==v(a))throw Error("Couldn't generate ODT file: roundtrip failed.");};this.getODT=function(a){return l.generate(a)}};
function parseSVM(B,C){function l(a,b){Object.keys(b).forEach(function(e){a[e]=b[e]})}function t(b,d){for(var e=Array(d),c=0;c<d;c++)e[c]=a(b);return e}function u(b,d,e){e=a("VersionCompat");d=g+e.length;b=b(e,d);g!==d&&(g=d);return b}function a(b,d,e,c){switch(b){case "uint8":case "bool":return e=r.getUint8(g,!0),g++,e;case "int8":return e=r.getInt8(g,!0),g++,e;case "uint16":return e=r.getUint16(g,!0),g+=2,e;case "int16":return e=r.getInt16(g,!0),g+=2,e;case "uint32":return e=r.getUint32(g,!0),g+=
4,e;case "int32":return e=r.getInt32(g,!0),g+=4,e;case "char":return String.fromCharCode(a("uint8"));case "utf16char":return String.fromCharCode(a("uint16"));case "Header":return u(function(b){return{version:b,compressionMode:a("uint32"),mapMode:a("MapMode"),width:a("uint32")*p,height:a("uint32")*p,actionCount:a("uint32")}},"Header");case "VersionCompat":return{version:a("uint16"),length:a("uint32"),valueOf:function(){return this.version}};case "MapMode":return u(function(b){return{version:b,unit:a("uint16"),
origin:a("Point"),scaleX:a("Fraction"),scaleY:a("Fraction"),isSimple:a("bool")}},"MapMode");case "Point":return{x:a("uint32")*p,y:a("uint32")*p};case "ByteString":return t("char",a("uint16")).join("");case "String":return t(y?"utf16char":"char",a(y?"int32":"uint16")).join("");case "Fraction":return{numerator:a("uint32"),denominator:a("uint32"),valueOf:function(){return this.numerator/this.denominator}};case "Font":return u(function(b){var c={version:b,family:a("ByteString"),style:a("ByteString"),
fontWidth:a("uint32")*p,fontHeight:a("uint32")*p,charset:a("uint16"),family2:a("uint16"),pitch:a("uint16"),weight:a("uint16"),underline:a("uint16"),strikeout:a("uint16"),italic:a("uint16"),language:a("uint16"),width:a("uint16")*p,orientation:a("int16"),wordline:a("bool"),outline:a("bool"),shadow:a("bool"),kerning:a("uint8")};2<=b&&(l(c,{relief:a("int8"),language2:a("uint16"),vertical:a("bool"),emphasis:a("uint16")}),3<=b&&l(c,{overline:a("uint16")}));return c},"Font");case "Color":return"#"+("00000"+
a("uint32").toString(16)).substr(-6);case "Rectangle":return{left:a("int32")*p,top:a("int32")*p,right:a("int32")*p,bottom:a("int32")*p};case "Polygon":case "SimplePolygon":case "ComplexPolygon":return t("Point",a("uint16"));case "PolyPolygon":return t("Polygon",a("uint16"));case "indexedComplexPolygon":return{simplePolygonIndex:a("uint16"),complexPolygon:a("ComplexPolygon")};case "LineInfo":return u(function(b){var c={version:b,style:a("uint16"),width:a("int32")};2<=b&&(l(c,{dashCount:a("uint16"),
dashLength:a("int32"),dotCount:a("uint16"),dotLength:a("int32"),distance:a("int32")}),3<=b&&l(c,{lineJoin:a("uint16")}));return c},"LineInfo");case "Size":return{width:a("uint32")*p,height:a("uint32")*p};case "Bitmap":return a("uint16"),e=a("uint32"),g-6+e>r.byteLength&&(e=c-(g-6)),c=new DataView(r.buffer,g-6,e),g=g-6+e,c;case "BitmapEx":return e={bitmap:a("Bitmap"),magic1:a("uint32"),magic2:a("uint32"),transparentType:a("uint8")},1===e.transparentType?l(e,{transparentColor:a("Color")}):2===e.transparentType&&
l(e,{transparentMask:a("Bitmap",null,null,c)}),e;case "Gradient":return u(function(b){return{version:b,gradientStyle:a("uint16"),startColor:a("Color"),endColor:a("Color"),angle:a("uint16"),border:a("uint16"),offsetX:a("uint16"),offsetY:a("uint16"),intensityStart:a("uint16"),intensityEnd:a("uint16"),stepCount:a("uint16")}});case "MetaFile":return e={},c=parseSVM(new DataView(r.buffer,g),e),g+=e.bytesRead,c;case f.META_FONT_ACTION:return{font:a("Font")};case f.META_TEXTARRAY_ACTION:return c={startPoint:a("Point"),
string:a("String"),startIndex:a("uint16"),len:a("uint16"),dxArray:t("int32",a("uint32"))},2<=e&&l(c,{string:t("utf16char",a("uint16")).join("")}),c;case f.META_RECT_ACTION:return a("Rectangle");case f.META_STRETCHTEXT_ACTION:return c={startPoint:a("Point"),string:a("String"),width:a("uint32")*p,startIndex:a("uint16"),len:a("uint16")},2<=e&&l(c,{string:t("utf16char",a("uint16")).join("")}),c;case f.META_FILLCOLOR_ACTION:return{color:a("Color"),set:a("bool")};case f.META_LINECOLOR_ACTION:return{color:a("Color"),
set:a("bool")};case f.META_TEXTCOLOR_ACTION:return{color:a("Color")};case f.META_TEXTFILLCOLOR_ACTION:return{color:a("Color"),set:a("bool")};case f.META_TEXTLINECOLOR_ACTION:return{color:a("Color"),set:a("bool")};case f.META_POLYLINE_ACTION:return c={simplePolygon:a("SimplePolygon")},2<=e&&(l(c,{lineInfo:a("LineInfo")}),3<=e&&(l(c,{hasFlags:a("bool")}),c.hasFlags&&l(c,{polygon:a("Polygon")}))),c;case f.META_POLYPOLYGON_ACTION:return c={simplePolygons:a("PolyPolygon")},2<=e&&l(c,{lineInfo:t("indexedComplexPolygon",
a("uint16"))}),c;case f.META_TRANSPARENT_ACTION:return{simplePolygons:a("PolyPolygon"),transparentPercentage:a("uint16")};case f.META_BMPEXSCALE_ACTION:return{bitmap:a("BitmapEx",null,null,c-16),point:a("Point"),size:a("Size")};case f.META_FLOATTRANSPARENT_ACTION:return{metaFile:a("MetaFile"),point:a("Point"),size:a("Size"),gradient:a("Gradient")};default:if(d)return null;throw"Unknown svm object type: "+b;}}function z(a,b,c){d.save();d.fillStyle=v;d.strokeStyle=E;d.translate(b,c);d.rotate(w/180*
Math.PI);a();d.restore()}function D(a){for(var b=[],c=0;c<a.byteLength;c++)b.push(String.fromCharCode(a.getUint8(c,!0)));return"data:image/bmp;base64,"+btoa(b.join(""))}var r=B instanceof DataView?B:new DataView(B);C||(C={});var g=6,f={META_NULL_ACTION:0,META_PIXEL_ACTION:100,META_POINT_ACTION:101,META_LINE_ACTION:102,META_RECT_ACTION:103,META_ROUNDRECT_ACTION:104,META_ELLIPSE_ACTION:105,META_ARC_ACTION:106,META_PIE_ACTION:107,META_CHORD_ACTION:108,META_POLYLINE_ACTION:109,META_POLYGON_ACTION:110,
META_POLYPOLYGON_ACTION:111,META_TEXT_ACTION:112,META_TEXTARRAY_ACTION:113,META_STRETCHTEXT_ACTION:114,META_TEXTRECT_ACTION:115,META_BMP_ACTION:116,META_BMPSCALE_ACTION:117,META_BMPSCALEPART_ACTION:118,META_BMPEX_ACTION:119,META_BMPEXSCALE_ACTION:120,META_BMPEXSCALEPART_ACTION:121,META_MASK_ACTION:122,META_MASKSCALE_ACTION:123,META_MASKSCALEPART_ACTION:124,META_GRADIENT_ACTION:125,META_HATCH_ACTION:126,META_WALLPAPER_ACTION:127,META_CLIPREGION_ACTION:128,META_ISECTRECTCLIPREGION_ACTION:129,META_ISECTREGIONCLIPREGION_ACTION:130,
META_MOVECLIPREGION_ACTION:131,META_LINECOLOR_ACTION:132,META_FILLCOLOR_ACTION:133,META_TEXTCOLOR_ACTION:134,META_TEXTFILLCOLOR_ACTION:135,META_TEXTALIGN_ACTION:136,META_MAPMODE_ACTION:137,META_FONT_ACTION:138,META_PUSH_ACTION:139,META_POP_ACTION:140,META_RASTEROP_ACTION:141,META_TRANSPARENT_ACTION:142,META_EPS_ACTION:143,META_REFPOINT_ACTION:144,META_TEXTLINECOLOR_ACTION:145,META_TEXTLINE_ACTION:146,META_FLOATTRANSPARENT_ACTION:147,META_GRADIENTEX_ACTION:148,META_LAYOUTMODE_ACTION:149,META_TEXTLANGUAGE_ACTION:150,
META_OVERLINECOLOR_ACTION:151,META_COMMENT_ACTION:512},y=0,p=.001/2.54*96,A=document.createElement("canvas"),x=a("Header");A.width=x.width;A.height=x.height;var d=A.getContext("2d");d.fillStyle="transparent";d.strokeStyle="transparent";var v="#000",E="transparent",w=0;d.setTransform(x.mapMode.scaleX,0,0,x.mapMode.scaleY,-x.mapMode.origin.x,-x.mapMode.origin.y);for(var c=[],F=0;F<x.actionCount;F++){var m=a("uint16"),q=Object.keys(f).find(function(a){return f[a]===m}),b=u(function(b,c){return a(m,q,
b,c)},m,q);if(b)switch(m){case f.META_FONT_ACTION:y=b.font.charset;d.font=(2===b.font.italic?"italic":1===b.font.italic?"oblique":"normal")+" "+(1<=b.font.weight&&10>=b.font.weight?b.font.weight-1+"00":"normal")+" "+b.font.fontHeight+'px "'+b.font.family.replace(/;/g,'", "')+'"';w=-b.font.orientation/10;break;case f.META_TEXTARRAY_ACTION:z(function(){d.fillText(b.string.substr(b.startIndex,b.len),0,0);d.strokeText(b.string.substr(b.startIndex,b.len),0,0)},b.startPoint.x,b.startPoint.y);break;case f.META_STRETCHTEXT_ACTION:z(function(){d.fillText(b.string.substr(b.startIndex,
b.len),0,0,b.width);d.strokeText(b.string.substr(b.startIndex,b.len),0,0,b.width)},b.startPoint.x,b.startPoint.y);break;case f.META_FILLCOLOR_ACTION:d.fillStyle=b.set?b.color:"transparent";break;case f.META_LINECOLOR_ACTION:d.strokeStyle=b.set?b.color:"transparent";break;case f.META_TEXTCOLOR_ACTION:v=b.color;break;case f.META_TEXTFILLCOLOR_ACTION:b.set&&(v=b.color);break;case f.META_TEXTLINECOLOR_ACTION:E=b.set?b.color:"transparent";break;case f.META_RECT_ACTION:d.rect(b.left,b.top,b.right-b.left,
b.bottom-b.top);d.fill();d.stroke();break;case f.META_POLYLINE_ACTION:d.beginPath();d.moveTo(b.simplePolygon[0].x,b.simplePolygon[0].y);for(var h=1;h<b.simplePolygon.length;h++)d.lineTo(b.simplePolygon[h].x,b.simplePolygon[h].y);d.fill();d.stroke();break;case f.META_TRANSPARENT_ACTION:d.globalAlpha=1-b.transparentPercentage/100;case f.META_POLYPOLYGON_ACTION:b.simplePolygons.forEach(function(a){d.beginPath();d.moveTo(a[0].x,a[0].y);for(var b=1;b<a.length;b++)d.lineTo(a[b].x,a[b].y);d.fill();d.stroke()});
d.globalAlpha=1;break;case f.META_BMPEXSCALE_ACTION:h=new Image;h.src="data:image/svg+xml,"+encodeURIComponent(['<svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="'+b.size.width+'" height="'+b.size.height+'">','\t<defs>\n\t\t<filter id="invert">\n\t\t\t<feColorMatrix in="SourceGraphic" type="matrix" values="-1 0 0 0 1\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t0 -1 0 0 1\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t0 0 -1 0 1\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t0 0  0 1 0"/>\n\t\t</filter>\n\t\t<mask id="maskImage">',
'\t\t\t<image x="0" y="0" width="'+b.size.width+'" height="'+b.size.height+'" xlink:href="'+D(b.bitmap.transparentMask)+'" filter="url(#invert)" />',"\t\t</mask>\n\t</defs>",'\t<image x="0" y="0" width="'+b.size.width+'" height="'+b.size.height+'" xlink:href="'+D(b.bitmap.bitmap)+'" mask="url(#maskImage)" />',"</svg>"].join("\n"));for(var n=0;!h.complete||!h.naturalWidth;){var k=new window.XMLHttpRequest;k.open("GET","data:text/plain,",!1);k.send();if(20<++n){console.error("[svm.js] Synchronously waiting for the image to be parsed took too long, aborted.");
break}}d.drawImage(h,b.point.x,b.point.y,b.size.width,b.size.height);break;case f.META_FLOATTRANSPARENT_ACTION:d.drawImage(b.metaFile,b.point.x,b.point.y,b.size.width,b.size.height);break;default:console.error("[svm.js] Unknown action type: "+q+" ("+m+")")}else-1===c.indexOf(q)&&c.push(q)}console.warn("[svm.js] The following action types are unsupported and were ignored: ",c);C.bytesRead=g;return A};
